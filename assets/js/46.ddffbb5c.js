(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{396:function(e,n,t){"use strict";t.r(n);var i=t(10),a=Object(i.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"how-to-debug-a-perspective-error"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-to-debug-a-perspective-error"}},[e._v("#")]),e._v(" How to debug a perspective error")]),e._v(" "),n("h2",{attrs:{id:"normal-logs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#normal-logs"}},[e._v("#")]),e._v(" Normal logs")]),e._v(" "),n("p",[e._v("This is an example log.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("2020-06-03 00:44:46.221 | INFO |           vanish_point: (  646, -1736)\n2020-06-03 00:44:46.222 | INFO |          distant_point: (-2321, -1736)\n2020-06-03 00:44:46.266 | INFO | 0.235s  _   Horizontal: 5 (7 inner, 3 edge)\n2020-06-03 00:44:46.266 | INFO | Edges: / \\    Vertical: 9 (10 inner, 3 edge)\n2020-06-03 00:44:46.273 | INFO |            Center grid: (3, 1)\n2020-06-03 00:44:46.493 | INFO | -- -- -- -- -- 2M -- --\n2020-06-03 00:44:46.501 | INFO | MY -- -- MY -- -- 3M --\n2020-06-03 00:44:46.501 | INFO | -- -- FL -- -- -- -- --\n2020-06-03 00:44:46.501 | INFO | -- 1L -- MY -- 2L --   \n")])])]),n("h2",{attrs:{id:"too-few-grid-lines"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#too-few-grid-lines"}},[e._v("#")]),e._v(" Too few grid lines")]),e._v(" "),n("p",[e._v("This may happens when it detected too few grid lines.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('  File "AzurLaneAutoScript\\module\\map\\camera.py", line 114, in update\n    self.grids = Grids(self.device.image, config=self.config)\n  File "AzurLaneAutoScript\\module\\map\\grids.py", line 19, in __init__\n    super().__init__(image, config)\n  File "AzurLaneAutoScript\\module\\map\\perspective.py", line 81, in __init__\n    self.crossings = self.horizontal.cross(self.vertical)\n  File "AzurLaneAutoScript\\module\\map\\perspective_items.py", line 170, in cross\n    points = np.vstack(self.cross_two_lines(self, other))\n  File "lib\\site-packages\\numpy\\core\\shape_base.py", line 234, in vstack\n    return _nx.concatenate([atleast_2d(_m) for _m in tup], 0)\n  File "lib\\site-packages\\numpy\\core\\shape_base.py", line 234, in <listcomp>\n    return _nx.concatenate([atleast_2d(_m) for _m in tup], 0)\n  File "AzurLaneAutoScript\\module\\map\\perspective_items.py", line 163, in cross_two_lines\n    for rho1, sin1, cos1 in zip(lines1.rho, lines1.sin, lines1.cos):\nAttributeError: \'Lines\' object has no attribute \'rho\'\n')])])]),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('  File "AzurLaneAutoScript\\module\\map\\camera.py", line 114, in update\n    self.grids = Grids(self.device.image, config=self.config)\n  File "AzurLaneAutoScript\\module\\map\\grids.py", line 19, in __init__\n    super().__init__(image, config)\n  File "AzurLaneAutoScript\\module\\map\\perspective.py", line 98, in __init__\n    self.horizontal, inner=inner_h.group(), edge=edge_h\n  File "AzurLaneAutoScript\\module\\map\\perspective.py", line 352, in line_cleanse\n    clean = self.mid_cleanse(origin, is_horizontal=lines.is_horizontal, threshold=threshold)\n  File "AzurLaneAutoScript\\module\\map\\perspective.py", line 346, in mid_cleanse\n    mids = convert_to_y(mids)\n  File "AzurLaneAutoScript\\module\\map\\perspective.py", line 277, in convert_to_y\n    return Points([[x, self.config.SCREEN_CENTER[1]] for x in xs], config=self.config) \\\n  File "AzurLaneAutoScript\\module\\map\\perspective_items.py", line 15, in __init__\n    self.x, self.y = self.points.T\nValueError: not enough values to unpack (expected 2, got 0)\n')])])]),n("p",[e._v("Try reduce the threshold of "),n("code",[e._v("cv2.HoughLines")]),e._v(". Default is 75.")]),e._v(" "),n("p",[e._v("Lower threshold means more lines.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("INTERNAL_LINES_HOUGHLINES_THRESHOLD = 40\nEDGE_LINES_HOUGHLINES_THRESHOLD = 40\n")])])]),n("p",[e._v("Then you should also lower this and make a closer fit to the lines.")]),e._v(" "),n("p",[e._v("Lower means closer fit, ignore more wrong lines.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("COINCIDENT_POINT_ENCOURAGE_DISTANCE = 1.5\n")])])]),n("h2",{attrs:{id:"camera-outside-map"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#camera-outside-map"}},[e._v("#")]),e._v(" Camera outside map")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('  File "AzurLaneAutoScript-master\\module\\map\\camera.py", line 114, in update\n    self.grids = Grids(self.device.image, config=self.config)\n  File "AzurLaneAutoScript-master\\module\\map\\grids.py", line 19, in __init__\n    super().__init__(image, config)\n  File "AzurLaneAutoScript-master\\module\\map\\perspective.py", line 98, in __init__\n    self.horizontal, inner=inner_h.group(), edge=edge_h\n  File "AzurLaneAutoScript-master\\module\\map\\perspective.py", line 383, in line_cleanse\n    raise PerspectiveError(\'Camera outside map: to the %s\' % (\'upper\' if lines.is_horizontal else \'right\'))\nmodule.exception.PerspectiveError: Camera outside map: to the upper\n')])])]),n("p",[e._v("Alas can not handle if camera is not focusing on any map grid, it will swipe back if catches "),n("code",[e._v("Camera outside map")]),e._v(". This may happens when some inner lines are detected as edge lines.")]),e._v(" "),n("p",[e._v("Try adjust the parameter of "),n("code",[e._v("scipy.signal.find_peaks")]),e._v(", the "),n("code",[e._v("height")]),e._v(" value.")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("height")]),e._v(" Lower means detect lighter lines, 255 means pure black.")]),e._v(" "),n("li",[n("strong",[e._v("width")]),e._v(" Line width, in pixels.")]),e._v(" "),n("li",[n("strong",[e._v("prominence")]),e._v(" Line needs to be how much darker than surrounding pixels.")]),e._v(" "),n("li",[n("strong",[e._v("distance")]),e._v(" Minimum distance between two detected point on line.")]),e._v(" "),n("li",[n("strong",[e._v("wlen")]),e._v(" Maximum amount of data to be processed in one time.")])]),e._v(" "),n("p",[e._v("Know more about these parameters "),n("a",{attrs:{href:"https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.find_peaks.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),n("OutboundLink")],1)]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("INTERNAL_LINES_FIND_PEAKS_PARAMETERS = {\n    'height': (150, 255 - 24),\n    'width': (0.9, 10),\n    'prominence': 10,\n    'distance': 35,\n}\nEDGE_LINES_FIND_PEAKS_PARAMETERS = {\n    'height': (255 - 24, 255),\n    'prominence': 10,\n    'distance': 50,\n    'width': (0, 10),\n    'wlen': 1000\n}\n")])])]),n("h2",{attrs:{id:"coincident-point-unexpected"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#coincident-point-unexpected"}},[e._v("#")]),e._v(" Coincident point unexpected")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("2020-05-31 20:04:47.397 | INFO | Horizontal coincident point unexpected: [-92.817316   141.99589405]\n2020-05-31 20:04:48.509 | INFO | Vertical coincident point unexpected: [-692.01967461  141.68981244]\n")])])]),n("p",[e._v("Try adjust the initial value of coincident point. if 141.99589405 is in (129 - 3, 129 + 3), it shut up.")]),e._v(" "),n("p",[e._v("But remember, an incorrect value will ruin everything in map detection, it usually works fine with these logs show up.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("MID_DIFF_RANGE_H = (129 - 3, 129 + 3)\nMID_DIFF_RANGE_V = (129 - 3, 129 + 3)\n")])])]),n("h2",{attrs:{id:"too-many-deleted-lines"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#too-many-deleted-lines"}},[e._v("#")]),e._v(" Too many deleted lines")])])}),[],!1,null,null,null);n.default=a.exports}}]);