(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{414:function(e,a,t){"use strict";t.r(a);var s=t(10),n=Object(s.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"_3-2-decorators-装饰器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-decorators-装饰器"}},[e._v("#")]),e._v(" 3.2. Decorators 装饰器")]),e._v(" "),a("p",[e._v("这里介绍 module/base/decorators.py 下的装饰器。")]),e._v(" "),a("h2",{attrs:{id:"config-when"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#config-when"}},[e._v("#")]),e._v(" @Config.when()")]),e._v(" "),a("p",[e._v("让一个函数在特定的设置情况下运行，常用于同一函数在不同服务器间的切换。需要实例拥有 config 属性，且为 AzurLaneConfig 对象。任何继承 ModuleBase 的类都可以使用这个装饰器。")]),e._v(" "),a("p",[e._v("当指定的属性值为 None 时，表示任何情况下均可运行。它的定义应后于其他函数，也就是这个函数要写在最下面。当 config 中的值不满足任何一个装饰器的要求时，显示 warning，并运行最后一个定义的函数.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("from module.base.decorator import Config\nfrom module.base.base import ModuleBase\n\nclass AnotherModule(ModuleBase):\n    @Config.when(SERVER='en')\n    def function(self):\n        # This method will be called only in EN server\n        pass\n\n    @Config.when(SERVER=None)\n    def function(self):\n        # This method will be called in other server\n        pass\n")])])]),a("p",[e._v("选择的属性不仅限于 SERVER，可以是 AzurLaneConfig 中的任何属性：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# module/config/config.py\nDEVICE_CONTROL_METHOD = 'uiautomator2'  # ADB, uiautomator2, minitouch\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("@Config.when(DEVICE_CONTROL_METHOD='minitouch')\n    def _commission_swipe(self, distance=190):\n        pass\n\n@Config.when(DEVICE_CONTROL_METHOD=None)\n    def _commission_swipe(self, distance=300):\n        pass\n")])])]),a("p",[e._v("也可以选择一个或多个属性：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("@Config.when(POOR_MAP_DATA=True, MAP_CLEAR_ALL_THIS_TIME=False)\n    def battle_function(self):\n        pass\n\n@Config.when(MAP_CLEAR_ALL_THIS_TIME=True)\n    def battle_function(self):\n        pass\n\n@Config.when(MAP_CLEAR_ALL_THIS_TIME=False, POOR_MAP_DATA=False)\n    def battle_function(self):\n        pass\n")])])]),a("h2",{attrs:{id:"cached-property"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cached-property"}},[e._v("#")]),e._v(" @cached_property")]),e._v(" "),a("p",[e._v("缓存属性。用 cached_property 装饰的类属性，只会计算一次。来自 "),a("a",{attrs:{href:"https://github.com/pydanny/cached-property",target:"_blank",rel:"noopener noreferrer"}},[e._v("cached_property"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("@cached_property\ndef bug_threshold(self):\n    return random_normal_distribution_int(55, 105, n=2)\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(">>> self.bug_threshold\n87\n>>> self.bug_threshold\n87\n")])])]),a("p",[e._v("重新计算属性：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(">>> del self.__dict__['bug_threshold']\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(">>> self.bug_threshold\n74\n")])])]),a("h2",{attrs:{id:"timer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timer"}},[e._v("#")]),e._v(" @timer")]),e._v(" "),a("p",[e._v("打印函数运行的耗时，这个装饰器在 module/base/timer.py 里。精度约 0.5ms，在调试使用。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("@timer\ndef do_something():\n    pass\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(">>> do_something()\ndo_something: 0.123456789 s\n")])])]),a("h2",{attrs:{id:"function-drop-rate-0-5-default-none"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#function-drop-rate-0-5-default-none"}},[e._v("#")]),e._v(" @function_drop(rate=0.5, default=None)")]),e._v(" "),a("p",[e._v("随机执行或者不执行某个函数，可以在测试中模拟模拟器卡顿。")])])}),[],!1,null,null,null);a.default=n.exports}}]);